# JetbotとNotebookの更新(fabo_2020版)

## JetBot fabo_2020での変更点
* データ取得画面にJetBot操作ボタンを追加
* Object Followingの追跡ターゲット設定をラベル選択に変更
* Collision AvoidanceにResNet18モデルを追加(NVIDIA公式対応)
* Collision AvoidanceにResNet18のTensorRT化を追加(NVIDIA公式対応)
* 学習時にグラフ表示を追加(NVIDIA公式対応)
* ResNet18学習にaccuracy追加(ベストモデルの保存、グラフ表示)
* Road Followingのデータ保存方法をJetRacerと同じ画面クリックに変更(NVIDIA公式対応)
* Road Followingの学習にファインチューニングの方法を追加
* 日本語解説の更新


## 最新のプロジェクトをGit clone
最新版のJetBotプロジェクト(https://github.com/NVIDIA-AI-IOT/jetbot) をベースとして日本語訳と多少変更をおこなったNotebookを取り込むために、FaBoPlatformのJetbotをGit cloneします。

* データのバックアップ

重要な学習やカスタマイズしたコードがある場合は、バックアップをとっておいた方がいいでしょう。
```
mv ~/Notebook ~/Notebook_old
```
* ビルド時間を短くするために、最大性能となるMAX-Nモードに変更します
```
sudo nvpmodel -m 0
```
* コード更新
```
cd ~/jetbot
git pull
git checkout fabo_2020
sudo python3 setup.py install --force 
```
もしエラーで失敗するときは、新しくダウンロードしなおします。
```
cd
sudo rm -rf jetbot
git clone https://github.com/FaBoPlatform/jetbot
cd jetbot
git checkout fabo_2020
sudo python3 setup.py install --force 
```
* Notebookの同期

最新版のJetbotプロジェクトのnotebookを~/Notebooksフォルダにrsyncします。
```
sudo apt-get install rsync
rsync -av ~/jetbot/notebooks/ ~/Notebooks
```
* pipライブラリをインストール(15分)

traitletsとnodejsをインストール
```
sudo python3 -m pip install git+https://github.com/ipython/traitlets@dead2b8cdde
sudo apt-get install -y curl
curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -
sudo apt-get install -y nodejs libffi-dev
```
クリックライブラリをインストール
```
cd
git clone https://github.com/jaybdub/jupyter_clickable_image_widget
cd jupyter_clickable_image_widget
sudo -H pip3 install -e .
sudo jupyter labextension install js
sudo jupyter lab build
```
グラフ表示ライブラリをインストール
```
sudo apt-get install -y python3-matplotlib
sudo -H pip3 install bokeh
sudo jupyter labextension install @bokeh/jupyter_bokeh
```
* 5Wモードに変更

MAX-Nモードのままだと、モバイルバッテリーの電力供給量が足りずにJetsonが落ちることがあります。  
特にバッテリー残量が低下したり、バッテリーが劣化している場合に頻発するため、普段は5Wモードにしておきます。
```
sudo nvpmodel -m 1
```
* 再起動
```
sudo reboot
```

!!! Warning ""
	`E: Could not get lock /var/lib/dpkg/lock-frontend - open (11: Resource temporarily unavailable)
	E: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?
	jetbot@jetbot:~$ rm -rf /var/lib/dpkg/lock-frontend`のエラーが出る場合は、`sudo rm -rf /var/lib/dpkg/lock-frontend`でロックファイルを削除します。
